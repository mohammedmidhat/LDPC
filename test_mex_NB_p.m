% This script invokes non-binary LDPC decoding simulations over GF(prime).
% A confusion matrix characterizes the noise of the channel
% The decoding is invoked through the GFq_LDPC() mex call.

% Author: Mohammed Al Ai Baky
% Created: 1/16/2018

conf_mat = [0.03 0.00 0.03 0.07 0.43 0.13 0.10 0.19 0.19 0.17 0.18 0.31 0.67;
            0.19 0.00 0.70 0.22 0.23 0.19 0.12 0.45 0.21 0.31 0.82 0.31 0.13;
            0.11 0.00 0.15 0.41 0.19 0.28 0.11 0.12 0.32 0.09 0.00 0.03 0.20;
            0.03 0.00 0.04 0.18 0.03 0.01 0.29 0.14 0.09 0.08 0.00 0.10 0.00;
            0.04 0.00 0.01 0.12 0.12 0.05 0.05 0.08 0.09 0.33 0.00 0.03 0.00;
            0.11 0.06 0.03 0.00 0.00 0.00 0.03 0.02 0.03 0.01 0.00 0.06 0.00;
            0.02 0.04 0.02 0.00 0.00 0.00 0.05 0.00 0.07 0.01 0.00 0.07 0.00;
            0.01 0.00 0.02 0.00 0.00 0.11 0.05 0.00 0.00 0.00 0.00 0.09 0.00;
            0.07 0.03 0.00 0.00 0.00 0.10 0.10 0.00 0.00 0.00 0.00 0.00 0.00;
            0.09 0.22 0.00 0.00 0.00 0.03 0.10 0.00 0.00 0.00 0.00 0.00 0.00;
            0.01 0.08 0.00 0.00 0.00 0.05 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.00 0.00 0.00 0.00 0.00 0.03 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.00 0.01 0.00 0.00 0.00 0.02 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.14 0.02 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.09 0.15 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.01 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.00 0.07 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.00 0.12 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.01 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.01 0.02 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.00 0.09 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.00 0.05 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.02 0.01 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.02 0.01 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.00 0.02 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00;
            0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00];

conf_mat = [0.9847840 0.0139895 0.0000255 0.0000155 0.0000114 0.0000084 0.0000059 0.0000039 0.0000034 0.0000021 0.0000027 0.0000031 0.0000021
0.0087214 0.9748988 0.0085484 0.0000089 0.0000041 0.0000028 0.0000022 0.0000015 0.0000011 0.0000010 0.0000004 0.0000003 0.0000003
0.0028491 0.0071774 0.9842616 0.0131510 0.0000090 0.0000049 0.0000030 0.0000014 0.0000010 0.0000010 0.0000001 0.0000000 0.0000000
0.0011229 0.0013231 0.0043733 0.9810494 0.0085022 0.0000088 0.0000045 0.0000029 0.0000015 0.0000013 0.0000011 0.0000007 0.0000005
0.0006703 0.0007363 0.0008533 0.0037111 0.9859362 0.0110699 0.0000112 0.0000066 0.0000035 0.0000017 0.0000011 0.0000002 0.0000001
0.0004357 0.0004539 0.0004846 0.0005682 0.0039235 0.9817458 0.0140495 0.0000120 0.0000052 0.0000019 0.0000008 0.0000003 0.0000004
0.0003259 0.0003312 0.0003458 0.0003680 0.0004489 0.0059308 0.9818821 0.0102436 0.0000093 0.0000045 0.0000017 0.0000007 0.0000005
0.0002499 0.0002509 0.0002591 0.0002712 0.0002846 0.0003349 0.0030719 0.9829200 0.0171050 0.0000143 0.0000051 0.0000011 0.0000004
0.0002329 0.0002357 0.0002436 0.0002440 0.0002540 0.0002629 0.0002997 0.0060889 0.9773297 0.0219789 0.0000157 0.0000026 0.0000006
0.0002334 0.0002333 0.0002316 0.0002373 0.0002439 0.0002442 0.0002655 0.0002931 0.0050632 0.9748123 0.0113106 0.0000123 0.0000022
0.0002117 0.0002133 0.0002129 0.0002171 0.0002209 0.0002234 0.0002330 0.0002505 0.0002796 0.0029406 0.9851586 0.0145705 0.0000226
0.0001292 0.0001232 0.0001271 0.0001239 0.0001265 0.0001305 0.0001355 0.0001360 0.0001561 0.0001927 0.0034395 0.9817952 0.0236278
0.0000336 0.0000334 0.0000332 0.0000345 0.0000350 0.0000327 0.0000359 0.0000394 0.0000414 0.0000477 0.0000627 0.0036129 0.9763424];


num_trials = 20;
max_num_iter = 30;
num_reads = 1;
decode_mode = 0;


tic;
result = GFq_LDPC(max_num_iter, num_trials, 0, num_reads, decode_mode, conf_mat');
err_count = result(1);
undet_err = result(2);
t_post = toc;
