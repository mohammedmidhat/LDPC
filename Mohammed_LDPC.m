conf_mat_2500 = [0.8593470 0.0043137 0.0000011 0.0000000 0.0000011 0.0000025 0.0000011 0.0000011 0.0000000 0.0000011 0.0000014 0.0000018 0.0000035;
0.0817776 0.9235419 0.0081999 0.0000004 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000;
0.0330589 0.0454663 0.9474035 0.0039379 0.0000004 0.0000000 0.0000004 0.0000000 0.0000004 0.0000000 0.0000000 0.0000000 0.0000000;
0.0154607 0.0180407 0.0344426 0.9784264 0.0036828 0.0000007 0.0000004 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000;
0.0043050 0.0046588 0.0058420 0.0131823 0.9872755 0.0055399 0.0000007 0.0000004 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000;
0.0013371 0.0013556 0.0014964 0.0017828 0.0060823 0.9882419 0.0055246 0.0000028 0.0000007 0.0000000 0.0000000 0.0000000 0.0000000;
0.0007123 0.0007348 0.0007574 0.0007722 0.0009542 0.0041692 0.9889631 0.0026854 0.0000011 0.0000000 0.0000000 0.0000000 0.0000000;
0.0004460 0.0005146 0.0004807 0.0004962 0.0005373 0.0006101 0.0039453 0.9918973 0.0062575 0.0000042 0.0000007 0.0000000 0.0000000;
0.0003905 0.0003845 0.0003692 0.0004104 0.0004155 0.0004274 0.0004984 0.0043061 0.9893302 0.0076915 0.0000070 0.0000025 0.0000000;
0.0003912 0.0003683 0.0003804 0.0003734 0.0003962 0.0003869 0.0004123 0.0004453 0.0036868 0.9891658 0.0044581 0.0000018 0.0000018;
0.0003468 0.0003342 0.0003283 0.0003376 0.0003473 0.0003279 0.0003529 0.0003715 0.0004162 0.0027574 0.9927862 0.0048995 0.0000074;
0.0001959 0.0001963 0.0002122 0.0001990 0.0002178 0.0002059 0.0002137 0.0002132 0.0002108 0.0002753 0.0026347 0.9918989 0.0064191;
0.0022309 0.0000904 0.0000862 0.0000816 0.0000897 0.0000875 0.0000872 0.0000769 0.0000964 0.0001048 0.0001118 0.0031956 0.9935682];

conf_mat_2000 = [0.88087 0.00403 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000;
0.07164 0.93726 0.00733 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000;
0.02768 0.03861 0.95744 0.00349 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000;
0.01204 0.01425 0.02842 0.98369 0.00347 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000;
0.00302 0.00324 0.00414 0.00989 0.98961 0.00473 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000;
0.00084 0.00090 0.00095 0.00116 0.00496 0.99026 0.00511 0.00000 0.00000 0.00000 0.00000 0.00000 0.00000;
0.00045 0.00049 0.00047 0.00050 0.00063 0.00365 0.99013 0.00244 0.00000 0.00000 0.00000 0.00000 0.00000;
0.00031 0.00032 0.00033 0.00035 0.00038 0.00042 0.00374 0.99277 0.00626 0.00000 0.00000 0.00000 0.00000;
0.00027 0.00026 0.00026 0.00026 0.00027 0.00028 0.00031 0.00407 0.98978 0.00753 0.00000 0.00000 0.00000;
0.00024 0.00023 0.00023 0.00025 0.00024 0.00024 0.00027 0.00028 0.00348 0.98966 0.00389 0.00000 0.00000;
0.00021 0.00021 0.00021 0.00021 0.00023 0.00022 0.00023 0.00023 0.00026 0.00254 0.99339 0.00439 0.00000;
0.00014 0.00014 0.00015 0.00014 0.00015 0.00014 0.00014 0.00014 0.00016 0.00018 0.00264 0.99284 0.00678;
0.00228 0.00005 0.00006 0.00005 0.00006 0.00007 0.00006 0.00006 0.00006 0.00008 0.00007 0.00276 0.99321];

conf_mat_1000 = [0.9631406 0.0004668 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000;
0.0288189 0.9874242 0.0011649 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000;
0.0054947 0.0091692 0.9934101 0.0010303 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000;
0.0017578 0.0020907 0.0044023 0.9961528 0.0010042 0.0000004 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000;
0.0005013 0.0005642 0.0007257 0.0024727 0.9960456 0.0007496 0.0000004 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000;
0.0001330 0.0001305 0.0001453 0.0001959 0.0027870 0.9972186 0.0017684 0.0000004 0.0000000 0.0000000 0.0000000 0.0000000 0.0000000;
0.0000556 0.0000514 0.0000443 0.0000570 0.0000669 0.0019091 0.9964864 0.0010289 0.0000007 0.0000004 0.0000000 0.0000000 0.0000000;
0.0000278 0.0000299 0.0000306 0.0000331 0.0000320 0.0000404 0.0016668 0.9971404 0.0021147 0.0000007 0.0000000 0.0000000 0.0000000;
0.0000222 0.0000190 0.0000275 0.0000211 0.0000204 0.0000260 0.0000288 0.0017791 0.9959272 0.0033636 0.0000014 0.0000004 0.0000000;
0.0000183 0.0000186 0.0000211 0.0000165 0.0000169 0.0000200 0.0000193 0.0000193 0.0019261 0.9953637 0.0021649 0.0000007 0.0000004;
0.0000144 0.0000200 0.0000137 0.0000105 0.0000134 0.0000190 0.0000165 0.0000165 0.0000183 0.0012589 0.9958380 0.0017883 0.0000014;
0.0000123 0.0000098 0.0000095 0.0000063 0.0000102 0.0000123 0.0000109 0.0000109 0.0000084 0.0000084 0.0019883 0.9966616 0.0028592;
0.0000032 0.0000056 0.0000049 0.0000039 0.0000035 0.0000046 0.0000025 0.0000046 0.0000046 0.0000042 0.0000074 0.0015491 0.9971390];

SbS_matrices = containers.Map({1,2,3},{conf_mat_2500,conf_mat_2000,conf_mat_1000});

num_trials = 1000000;
max_num_iter = 30;
num_reads = 1;      % 1 read: hard info, 3 reads: soft info
decode_mode = 0;    % 0: generated noise from SbS matrix, 1: raw read data in a file

sequential = containers.Map({1,2,3},{10,25,400});    % number of iterations in the sequential loop in the .C file
parallel = num_trials/sequential;   % number of iterations in the parfor loop in this script
num_cores = 2;

err_count = zeros(1,parallel);
undet_err = zeros(1,parallel);

for i=1:length(keys(SbS_matrices))
    tic;
    parfor (j = 1:parallel, num_cores)
        result = GFq_LDPC(max_num_iter, sequential, 0, num_reads, decode_mode, SbS_matrices(i)');
        err_count(1,j) = result(1);
        undet_err(1,j) = result(2);
    end
    err_count
    undet_err
    t_post = toc
end

tic;
result = GFq_LDPC(max_num_iter, 20, 0, num_reads, decode_mode, conf_mat_2500');
t_post = toc;